<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>VR Pre-Test</title>
  <meta name="description" content="VR Pre-Test Battery"/>
  <link rel="icon" href="data:,">

  <!-- jsPsych CSS -->
  <link rel="stylesheet" href="https://unpkg.com/jspsych@7.3.4/css/jspsych.css">

  <!-- SurveyJS (NON-jQuery) CSS -->
  <link rel="stylesheet" href="https://unpkg.com/survey-core@1.11.7/defaultV2.min.css">
  <link rel="stylesheet" href="https://unpkg.com/survey-js-ui@1.11.7/survey-js-ui.min.css">

  <!-- jsPsych core -->
  <script src="https://unpkg.com/jspsych@7.3.4/dist/jspsych.js" defer></script>

  <!-- jsPsych plugins used by pretest.js -->
  <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.3/dist/index.js" defer></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.3/dist/index.js" defer></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-text@1.1.3/dist/index.js" defer></script>
  <script src="https://unpkg.com/@jspsych/plugin-initialize-microphone@1.0.3/dist/index.js" defer></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-audio-response@1.0.3/dist/index.js" defer></script>

  <!-- SurveyJS (NON-jQuery) JS -->
  <script src="https://unpkg.com/survey-core@1.11.7/survey.core.min.js" defer></script>
  <script src="https://unpkg.com/survey-js-ui@1.11.7/survey-js-ui.min.js" defer></script>

  <!-- jsPsych ↔ SurveyJS bridge (YOUR file; ensure this path exists in your repo) -->
  <!-- If your plugin is named differently or in another folder, update the src -->
  <script src="/plugins/jspsych-survey.js" defer></script>

  <style>
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
    .wrap { max-width: 980px; margin: 24px auto; padding: 0 16px; }
    header { display:flex; align-items:center; justify-content:space-between; margin-bottom: 12px; }
    header h1 { font-size: 20px; margin: 0; }
    #jspsych-target { min-height: 60vh; }
    .precheck { font-size: 12px; color:#666; margin-bottom:12px; }
    .warn { color:#c1272d; font-weight: 600; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>VR Pre-Test</h1>
      <div class="precheck" id="lib-check">Loading libraries…</div>
    </header>

    <!-- jsPsych renders here -->
    <div id="jspsych-target"></div>

    <!-- Optional: quick asset sanity hints -->
    <details>
      <summary>Help / Requirements</summary>
      <ul>
        <li>Make sure your assets exist at the paths used in <code>pretest.js</code>:
          <ul>
            <li><code>sounds/*.mp3</code> for phoneme/foley</li>
            <li><code>img/*.jpg|jpeg|svg</code> for picture/visual tasks</li>
            <li><code>pron/*.mp3</code> if you use model pronunciations</li>
          </ul>
        </li>
        <li>SurveyJS is loaded via <code>survey-core</code> + <code>survey-js-ui</code> (no jQuery).</li>
        <li>Bridge plugin must be at <code>/plugins/jspsych-survey.js</code> (or update the script tag above).</li>
      </ul>
    </details>
  </div>

  <!-- Your pretest logic (the robust file I gave you) -->
  <script src="pretest.js" defer></script>

  <!-- Light runtime check to surface missing libs early -->
  <script defer>
    document.addEventListener('DOMContentLoaded', () => {
      const el = document.getElementById('lib-check');
      try {
        const ok = [
          ['initJsPsych', typeof window.initJsPsych === 'function'],
          ['Survey', typeof window.Survey === 'object'],
          // Plugin names vary; most bridges register type name on use, so just note it's expected:
        ];
        const missing = ok.filter(([_, v]) => !v).map(([k]) => k);
        if (missing.length) {
          el.innerHTML = 'Missing: <span class="warn">' + missing.join(', ') + '</span>. Check script tags.';
        } else {
          el.textContent = '✓ All components loaded successfully';
        }
      } catch (e) {
        el.textContent = 'Library check failed. Open console.';
      }
    });
  </script>
</body>
</html>
