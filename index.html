<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VR Pre-Test Battery</title>
  
  <!-- jsPsych Core CSS -->
  <link href="https://unpkg.com/jspsych@7.3.3/css/jspsych.css" rel="stylesheet" type="text/css" />
  
  <!-- SurveyJS CSS -->
  <link href="https://unpkg.com/survey-jquery@1.9.116/defaultV2.min.css" rel="stylesheet" type="text/css" />
  
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: #f5f5f5;
    }
    
    #jspsych-target {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      min-height: 400px;
    }
    
    .loading {
      text-align: center;
      padding: 60px 20px;
      color: #666;
    }
    
    .loading-spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #4CAF50;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="jspsych-target">
    <div class="loading">
      <div class="loading-spinner"></div>
      <p>Loading experiment...</p>
    </div>
  </div>

  <!-- jsPsych Core (v7.3.3) -->
  <script src="https://unpkg.com/jspsych@7.3.3"></script>
  
  <!-- jsPsych Plugins -->
  <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-audio-button-response@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-image-button-response@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-text@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-initialize-microphone@1.0.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-audio-response@1.0.3"></script>
  
  <!-- SurveyJS (for advanced surveys) -->
  <script src="https://unpkg.com/survey-jquery@1.9.116/survey.jquery.min.js"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey@0.2.2"></script>
  
  <!-- Your Pre-Test Script -->
  <script src="pretest.js"></script>
  
  <script>
    // Check if all required components loaded
    window.addEventListener('load', function() {
      console.log('Page loaded, checking dependencies...');
      
      const required = [
        'initJsPsych',
        'jsPsychHtmlButtonResponse',
        'jsPsychHtmlKeyboardResponse',
        'jsPsychSurveyText',
        'jsPsychSurvey',
        'jsPsychAudioButtonResponse',
        'jsPsychImageButtonResponse',
        'jsPsychInitializeMicrophone',
        'jsPsychHtmlAudioResponse'
      ];
      
      const missing = required.filter(name => typeof window[name] === 'undefined');
      
      if (missing.length > 0) {
        console.error('Missing required components:', missing);
        document.getElementById('jspsych-target').innerHTML = `
          <div style="text-align:center;padding:40px;">
            <h2 style="color:#d32f2f;">⚠️ Loading Error</h2>
            <p>Some required components failed to load:</p>
            <ul style="text-align:left;max-width:400px;margin:20px auto;">
              ${missing.map(m => `<li><code>${m}</code></li>`).join('')}
            </ul>
            <p>Please refresh the page. If the problem persists, check your internet connection.</p>
            <button onclick="location.reload()" style="margin-top:20px;padding:12px 24px;border:none;border-radius:8px;background:#4CAF50;color:white;cursor:pointer;font-size:16px;">
              Reload Page
            </button>
          </div>
        `;
      } else {
        console.log('✓ All components loaded successfully');
      }
    });
  </script>
</body>
</html>