<!doctype html>
<meta charset="utf-8" />
<title>Mic Test</title>

<link rel="stylesheet" href="https://unpkg.com/jspsych@7.3.4/css/jspsych.css">

<div id="jspsych-target"></div>

<!-- Core (v7) -->
<script src="https://unpkg.com/jspsych@7.3.4"></script>

<!-- Plugins (load AFTER core) -->
<script src="https://unpkg.com/@jspsych/plugin-html-button-response@2.1.0"></script>
<script src="https://unpkg.com/@jspsych/plugin-initialize-microphone@1.0.3"></script>
<script src="https://unpkg.com/@jspsych/plugin-html-audio-response@1.0.3"></script>

<script>
  const jsPsych = initJsPsych({ show_progress_bar: true, on_finish: () => jsPsych.data.displayData() });

  const timeline = [
    { type: jsPsychHtmlButtonResponse, stimulus: '<p>Click "Begin" to allow microphone.</p>', choices: ['Begin'] },
    { type: jsPsychInitializeMicrophone, device_select: true },
    {
      type: jsPsychHtmlAudioResponse,
      stimulus: '<p>Say something, then click <strong>Finish recording</strong>.</p>',
      recording_duration: null,         // user-controlled
      show_done_button: true,
      done_button_label: 'Finish recording',
      allow_playback: true
    }
  ];

  jsPsych.run(timeline);
</script>
